<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<meta name="author" content="Author Pierre Terree - Calypso Networks Association">
<title>Keyple 'Core' - Architecture &amp; Secure Element universal interface definition</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Keyple 'Core' - Architecture &amp; Secure Element universal interface definition</h1>
<div class="details">
<span id="author" class="author">Author Pierre Terree - Calypso Networks Association</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_global_architecture">1. Global architecture</a></li>
<li><a href="#_secure_element_proxy_api">2. 'Secure Element Proxy' API</a>
<ul class="sectlevel2">
<li><a href="#_functional_processing">2.1. Functional processing</a></li>
<li><a href="#_se_proxy_api_for_terminal_application_implementation">2.2. SE Proxy API - for terminal application implementation</a>
<ul class="sectlevel3">
<li><a href="#_access_to_configurable_se_readers">2.2.1. Access to configurable SE readers</a></li>
<li><a href="#_apdu_command_transmission">2.2.2. APDU command transmission</a></li>
<li><a href="#_notification_of_plugin_reader_events">2.2.3. Notification of plugin &amp; reader events</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_reader_plugin_implementation_factorization_library">3. Reader Plugin implementation - factorization library</a>
<ul class="sectlevel2">
<li><a href="#_plugin_processing_classes">3.1. Plugin processing classes</a></li>
<li><a href="#_examples_of_some_standard_reader_plugin_integrations">3.2. Examples of some standard reader plugin integrations</a></li>
</ul>
</li>
<li><a href="#_generic_command_api">4. 'Generic Command' API</a>
<ul class="sectlevel2">
<li><a href="#_interface_commandstable">4.1. Interface: CommandsTable</a></li>
<li><a href="#_abstract_class_apducommandbuilder">4.2. abstract Class: ApduCommandBuilder</a></li>
<li><a href="#_abstract_class_apduresponseparser">4.3. abstract Class: ApduResponseParser</a></li>
</ul>
</li>
<li><a href="#_remote_se_service">5. 'Remote SE' service</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_global_architecture">1. Global architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Keyple SDK is divided in two major layers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The ‘Secure Element Proxy API’ which allows to manage SE readers in a generic way.</p>
</li>
<li>
<p>The ‘Calypso Processing API’ which contains at least the full sets of commands for Calypso Portable Object and Security Module, and the macro commands to manage secure Calypso transactions. This module could also be extended with features to support the Hoplink application.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/20180322-CNA-SDK-Architecture-GlobalArch.svg" alt="Scheme - Global Architecture">
</div>
</div>
<div class="paragraph">
<p>Dedicated reader’s plugins have to be implemented in order to interface the SE Proxy API with the specific reader’s drivers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_secure_element_proxy_api">2. 'Secure Element Proxy' API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_functional_processing">2.1. Functional processing</h3>
<div class="imageblock">
<div class="content">
<img src="./img/20180322-CNA-SDK-Architecture-Plugins.svg" alt="Scheme - SE Proxy&#8217;s Plugins">
</div>
</div>
<div class="paragraph">
<p>The SE Proxy API must provide a common way to manage local or remote SE readers, providing a common interface to address NFC mobile environment or PC/SC compliant readers, or any proprietary drivers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The PC/SC API provides basic functions to list and select compliant readers, to establish a connection, and to transfer APDU commands and get the corresponding responses, one by one.</p>
</li>
<li>
<p>The Smart Card IO API, used as PC/SC interface for J2SE application, provides a higher abstraction level by automatically managing 61XXh and 6CXXh warning status. In this case, the usage of the Get Response command is no longer required, ISO 7816-4 APDU command could be managed in the same way whatever the transmission protocol ISO 7816-3 T=0 or T=1, case 4 APDU commands are always processed as in contactless.</p>
<div class="ulist">
<ul>
<li>
<p>‘Case 4’ commands shall always be set with ’Le’ at 00h.</p>
</li>
<li>
<p>‘Case 2’ commands must not be set with a ‘Le’ value higher than the number of available bytes.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The Open Mobile API, defined to address SE in mobile environments, adds another step of abstraction with the automatic allocation of logical channels. In this case, the Select Application command is useless; a logical channel opening is requested for a specific AID, then API performs directly the selection for the first available or the specified logical channel. The class bytes of the coming APDU commands are automatically updated for the selected logical channel.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To simplify the management of logical channels with a SE, <strong>the SE Proxy API limits the establishment of only one logical channel at a time per SE.</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Calypso PO supports the selection of only one application at a time.</p>
</li>
<li>
<p>A CSM HSM plugin could emulate the presence of several CSM SE.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To optimize the interfacing with remote SE readers (PO or SAM):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SE proxy API may manage grouped APDU commands: in order to perform operations comprised of sets of APDU requests and get the corresponding set of APDU responses through a single call. It may still be possible to emulate an APDU by APDU sequential transaction by using commands groups containing a single APDU command.</p>
</li>
<li>
<p>A single SE reader call may allow to specify at once the AID of the application to select (in order to open a specific logical channel if necessary), to transmit a group of APDU commands to play, and to define the final logical channel status after the receipt of the last APDU response of the group (in order to keep the channel open or to close it).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To support revision 1.0 and 2.4 Calypso POs in contacts T=0 mode, APDU commands’ information may declare if the ISO 7816-4 APDU is a case 4. If a case 4 response misses its data bytes, the SE plugin may send a Get Response command to retrieve the missing data.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="title">Support of old Calypso products not compliant with ISO 7816-4 for ‘case 4’ APDU in contacts mode:</div>
<div class="ulist">
<ul>
<li>
<p>Calypso Revision 2.4 Portable Objects and ‘S1Dx’ SAM replies on a case 4 APDU in contacts mode the successful status 9000h instead of 61XYh → in this case the Reader Plugin wouldn’t be able to automatically request a GetResponse command for a length XYh.</p>
</li>
<li>
<p>To recover this, case 4 APDU could be highlighted with this ‘case 4’ flag: then in case of missing data in the response with a successful status, the plugin will have to request a GetResponse for a length 00h.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="title">Plugins’ rules:</div>
<div class="ulist">
<ul>
<li>
<p>On a request to transmit a set of APDU commands to a specific SE Application, the SE plugin or its lower driver must open a logical channel and select the targeted application (if not already selected) <strong>without expecting an explicit SelectApplication command</strong> from the SE Proxy.</p>
</li>
<li>
<p><strong>Only one single logical channel</strong> could be open at a time with a SE Reader.</p>
<div class="ulist">
<ul>
<li>
<p>A smartcard reader with several physical interfaces (e.g.: several contactless antennas, or several SAM slots) &#8658; should be managed through several SE Proxy.</p>
</li>
<li>
<p>For a Secure Element supporting several logical channels at a time through a physical interface: the logical channels could be managed though different SE Proxy.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Readers’ specific settings (e.g. contactless protocol sequences polling, communication speed, …) may be managed at the plugin level. The SE proxy API provides a generic way to push or get specific reader’s parameters.</p>
</div>
<div class="paragraph">
<p>On a terminal, the SE Proxy API could be interfaced with several plugins at a time, in order to address PO and CSM, to operate both local and remote readers, supporting both PC/SC and proprietary readers.</p>
</div>
<div class="paragraph">
<p>All the classes and interfaces defining the SE Proxy Service will be contained in the package ‘org.eclipse.keyple.seproxy’.</p>
</div>
</div>
<div class="sect2">
<h3 id="_se_proxy_api_for_terminal_application_implementation">2.2. SE Proxy API - for terminal application implementation</h3>
<div class="sect3">
<h4 id="_access_to_configurable_se_readers">2.2.1. Access to configurable SE readers</h4>
<div class="imageblock">
<div class="content">
<img src="./img/uml-classDiagram-seProxy-AccessReader.svg" alt="Class Diagram - SE Proxy Reader Access">
</div>
</div>
<div class="paragraph">
<p>The SE Proxy Service singleton is the <strong>entry point of the SE Proxy Service</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>its instance has to be &lt;b&gt;called by a ticketing application&lt;b/&gt; in order to establish a link with a SE’s readers.</p>
</li>
<li>
<p>Different specific reader plugins could be set to the SE Proxy Service: each reader plugin is defined with a unique name.</p>
</li>
<li>
<p>On the SE Proxy Service the list of Reader Plugins currently set could be recovered sort by plugin name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ReadersPlugin is the generic interface to manage drivers of SE reader (PC/SC, NFC Android, &#8230;&#8203;):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For a specific reader plugin, different SE readers could be available: each reader of a plugin is defined with a unique name.</p>
</li>
<li>
<p>The list of available SE readers could be recovered sort by reader name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ProxyReader is the generic interface to manage SE readers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A SE reader provides the possibility to check is a SE is present in the reader.</p>
</li>
<li>
<p>By defining some specific SE protocols' settings, we could configure a reader to recognize the communication protocol (contacts: ISO 7816-3, contactless: ISO 14443-4, B', Mifare, &#8230;&#8203;) of the targeted SE.</p>
</li>
<li>
<p>Some set of SE requests, containing APDU commands to operate, could be transmit to reader, in order to get the corresponding response, according to SE present in the reader.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Plugins &amp; SE readers could require the setting of specific parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_apdu_command_transmission">2.2.2. APDU command transmission</h4>
<div class="imageblock">
<div class="content">
<img src="./img/uml-classDiagram-seProxy-TransmitApdu.svg" alt="Class Diagram - SE Proxy APDU Transmission">
</div>
</div>
<div class="paragraph">
<p>A SE Request aggregates the elements to open a logical channel with a SE and select a SE application, and group of APDU to exchange with the selected application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When defining an optional protocol flag to a SE Request, the reader will try to operate the request only if the SE communication protocol matches the flag.</p>
</li>
<li>
<p>For SE application requiring an explicit selection: an AID should be defined in the SE Request (through an AidSelector), in this case the reader build and transmit the right Select Application.</p>
</li>
<li>
<p>The grouping of APDU command requests in a SE request allows to optimize the network messages in case the reader is remote to the terminal.</p>
</li>
<li>
<p>After the processing of a SE Request a reader automatically close the logical channel with the SE application: except if the SE request explicitly ask to keep it open.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A terminal could accept on a reader several kinds of SE applications: those applications could be selected through different AID and could be based on different SE protocol.
Depending on the kind of SE applications set as supported on a reader: the transmission of a set of SE requests could be requested.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SE requests of a set are processed sequentially.</p>
<div class="ulist">
<ul>
<li>
<p>If the protocol flag of a SE request matches the SE protocols defined for the reader, then the reader tries to open a logical channel.</p>
</li>
<li>
<p>A non-matching SE request is skipped.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For a specific SE request, if a logical is opened, the included APDU commands are transmitted to the selected application.</p>
<div class="ulist">
<ul>
<li>
<p>In case the SE request is defined to keep the logical channel open, the processing of the SE request set stops even if there are remaining SE requests with SE protocol flags matching the reader setting.</p>
</li>
<li>
<p>Otherwise, if the logical channel could be closed after the APDU transmission:</p>
<div class="ulist">
<ul>
<li>
<p>The reader processes the next pending SE request matching the reader protocol settings.</p>
</li>
<li>
<p>If there is no more SE request to process, and no logical channel to maintain, then the reader could finally close the physical channel with the SE.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>By defining an APDU request with a 'case 4' flag, in case SE application doesn&#8217;t reply data: the reader is in charge to transmit a Get Response in order to recover the response. This 'hack' allows to support SE not fully compliant with ISO 7816-4 for case 4 APDU commands (e.g. as for the first generation of Calypso revision 1 native SE).
For an APDU request, the optional setting of successful status code other that 0x9000 allows the reader to identify is a corresponding APDU response is successful.</p>
</div>
<div class="paragraph">
<p>In a SE response, at least one between the ATR field &amp; the FCI should be non-null:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A SE application explicitly selected with an AID may provide FCI data.</p>
</li>
<li>
<p>A SE application implicitly selected is generally identified with the ATR of the SE.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_notification_of_plugin_reader_events">2.2.3. Notification of plugin &amp; reader events</h4>
<div class="imageblock">
<div class="content">
<img src="./img/uml-classDiagram-seProxy-Event.svg" alt="Class Diagram - SE Proxy Reader Event">
</div>
</div>
<div class="paragraph">
<p>To be notified on plugin events (hot-plug / unplug of some readers) &amp; reader events (insertion / remove of a SE in a specific reader), a terminal application could respectively implement interfaces of Plugin Observer or Reader Observer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Observers could be defined for a specific plugin or a reader.</p>
</li>
<li>
<p>In case of status change, an observable plugin or reader will notify its observers.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reader_plugin_implementation_factorization_library">3. Reader Plugin implementation - factorization library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The 'plugin' package provides a set of abstract classes which factorize most of Reader Plugin generic processing: these classes could only be extended for the implementation of a specific plugin. Thereby the definition of a specific Reader Plugin could be limited to a simple wrapping of the Reader Driver natives commands.</p>
</div>
<div class="paragraph">
<p><strong>The access to elements of the 'plugin' package is forbidden for top applications based on the Keyple SE Proxy Service.</strong></p>
</div>
<div class="sect2">
<h3 id="_plugin_processing_classes">3.1. Plugin processing classes</h3>
<div class="imageblock">
<div class="content">
<img src="./img/uml-classDiagram-seProxy-FactorizedPlugin.svg" alt="Class Diagram - SE Proxy Plugin Factorization">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Plugin processing classes</strong></th>
<th class="tableblock halign-left valign-top"><strong>Extended by classes implementing</strong></th>
<th class="tableblock halign-left valign-top"><strong>Conditions</strong></th>
<th class="tableblock halign-left valign-top"><strong>Factorized operations</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractLoggedObservable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadersPlugin or ProxyReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>management of the naming,</p>
</li>
<li>
<p>logging of observability operations</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractObservablePlugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadersPlugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>ProxyReader list management,</p>
</li>
<li>
<p>name-based comparison of ReadersPlugin (required for SortedSet&lt;ReadersPlugin&gt;)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractThreadedObservablePlugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadersPlugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for plugins observing <strong>SE reader configuration through a listening thread</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">management of hot-plug/unplug of ProxyReader</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractStaticPlugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadersPlugin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for plugins with a <strong>SE Readers static configuration</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractObservableReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProxyReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>High level logging &amp; benchmarking of SeRequestSet transmission, &amp; SeResponseSet reception (transmit method of ProxyReader),</p>
</li>
<li>
<p>name-based comparison of ProxyReader (required for SortedSet&lt;ProxyReader&gt;)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractLocalReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProxyReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for plugins operating <strong>local SE readers</strong> (normally all plugins except the Remote SE plugin)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Management of the loop processing for SeRequest transmission in a set and for SeResponse reception in a set</p>
</li>
<li>
<p>Low level logging of ApduRequest transmission and ApduResponse reception</p>
</li>
<li>
<p>Case 4 APDU hack processing (automatic send of GetResponse command in case of response missing data.</p>
</li>
<li>
<p>SE logical channel state management</p>
</li>
<li>
<p>SE reader protocol setting</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractSelectionLocalReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProxyReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for local readers requiring the set of a <strong>Select Application</strong> command with AID</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>SE logical channel opening &amp; application selection through AID</p>
</li>
<li>
<p>ReaderObserver list setting</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AbstractThreadedLocalReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProxyReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">for local readers managing <strong>SE detection through a listening thread</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management of the thread listening SE insertion/remove for a reader.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_examples_of_some_standard_reader_plugin_integrations">3.2. Examples of some standard reader plugin integrations</h3>
<div class="ulist">
<ul>
<li>
<p>"Remote SE Plugin": by definition, remote readers aren&#8217;t managed locally; the plugin could notify in case a connection with a remote reader is established or lost.</p>
</li>
<li>
<p>"PC/SC Plugin": the plugin requires to manage the selection of a specific SE application, threads are involved to listen notification of reader plug/unplug and SE insertion/remove.</p>
</li>
<li>
<p>"Android NFC Plugin": the configuration is limited to a single reader that can&#8217;t be removed; SE insertion are notified through Android Intent.</p>
</li>
<li>
<p>"Android OMAPI": the configuration of SE contacts readers is static; SE presence is readers is managed statically too.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/uml-classDiagram-seProxy-NativePlugin.svg" alt="Class Diagram - SE Proxy Native Plugins Integration">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generic_command_api">4. 'Generic Command' API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The 'Commands' module is the base to define the APDU commands’ sets for a specific Secure Element application. All these commands could be operated independently in <strong>standalone</strong>.</p>
</div>
<div class="paragraph">
<p>To manage SE commands, the library requires:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>functions to <strong>build</strong> APDU requests in order to generate the arrays of bytes to send to a SE in a group of APDU requests (SeRequestElement),</p>
</li>
<li>
<p>and functions to <strong>parse</strong> the arrays of bytes replied by the SE in a group of APDU responses (SeResponseElement).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./img/uml-classDiagram-commands-GenericTable.svg" alt="Class Diagram - SE Proxy Generic Commands Table">
</div>
</div>
<div class="sect2">
<h3 id="_interface_commandstable">4.1. Interface: CommandsTable</h3>
<div class="paragraph">
<p>This interface allows to define a register of Commands’ Sets including association between Commands’ Builders and Responses’ Parsers. It provides the generic getters to retrieve: the name &amp; the instruction byte of a command, and the corresponding ApduCommandBuilder &amp; ApduResponseParser classes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Method: String getName()</p>
<div class="ulist">
<ul>
<li>
<p>returns the command name.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Method: Byte getInstructionByte()</p>
<div class="ulist">
<ul>
<li>
<p>returns the value of the INS byte.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Method: Class getCommandBuilderClass()</p>
<div class="ulist">
<ul>
<li>
<p>returns the Command Builder class.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Method: Class getResponseParserClass()</p>
<div class="ulist">
<ul>
<li>
<p>returns the Response Parser class.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_abstract_class_apducommandbuilder">4.2. abstract Class: ApduCommandBuilder</h3>
<div class="paragraph">
<p>This <strong>abstract</strong> class has to be <strong>extended by all SE command builder classes</strong>, it provides the generic getters to retrieve: the name of the command, the built ApduRequest, the corresponding ApduResponseParser class.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>private</strong> Attribute: CommandsTable commandReference</p>
<div class="ulist">
<ul>
<li>
<p>the reference of the command in the matrix array enumeration, in order to get the name and the response parser class of the command.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>private</strong> Attribute: ApduRequest request</p>
<div class="ulist">
<ul>
<li>
<p>the byte array APDU request.</p>
</li>
<li>
<p><strong>For ‘case 4’ APDU command, the ‘Le’ field shall be present with the value 00h.</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>abstract</strong> Method: ApduCommandBuilder(CommandsTable reference, ApduRequest request)</p>
<div class="ulist">
<ul>
<li>
<p>the generic abstract constructor to build an APDU request with a command reference and a byte array.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>final</strong> Method: String getName()</p>
<div class="ulist">
<ul>
<li>
<p>returns the name of the APDU command from the CommandsTable information.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>final</strong> Method: ApduRequest getApduRequest()</p>
<div class="ulist">
<ul>
<li>
<p>returns the APDU request.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>final</strong> Method: Class getApduResponseParserClass()</p>
<div class="ulist">
<ul>
<li>
<p>returns the corresponding ApduResponseParser class of the APDU command from the CommandsTable information.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_abstract_class_apduresponseparser">4.3. abstract Class: ApduResponseParser</h3>
<div class="paragraph">
<p>This <strong>abstract</strong> class has to be <strong>extended by all SE response parser classes</strong>, it provides the generic getters to manage response’s status.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>private</strong> Attribute: ApduUResponse response</p>
<div class="ulist">
<ul>
<li>
<p>the byte array APDU response.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>protected</strong> inner Class (or struct) StatusProperties</p>
<div class="ulist">
<ul>
<li>
<p><strong>protected</strong> Attribute: Boolean successful</p>
</li>
<li>
<p><strong>protected</strong> Attribute: String information</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>protected</strong> Attribute: Map&lt;Short, StatusProperties&gt;: statusTable</p>
<div class="ulist">
<ul>
<li>
<p>A map with the double byte of a status as key, and the successful property and ASCII text information as data.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>abstract</strong> Method: ApduResponseParser(ApduResponse responseToParse, Map&lt;Short, StatusProperties&gt;)</p>
<div class="ulist">
<ul>
<li>
<p>the generic abstract constructor to build a parser of the APDU response, it sets the ApduResponse and the Map of StatusProperties pushed by the sub-classes.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>final</strong> Method: ApduResponse getApduResponse ()</p>
<div class="ulist">
<ul>
<li>
<p>returns the ApduResponse instance.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>final</strong> Method: Short (or unsigned short) getStatusCode)</p>
<div class="ulist">
<ul>
<li>
<p>Returns SW1-SW2 bytes from the ApduResponse.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>final</strong> Method: Boolean isSuccessful()</p>
<div class="ulist">
<ul>
<li>
<p>Returns if the status is successful from the statusTable according to the current status code.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>final</strong> Method: String getStatusInformation()</p>
<div class="ulist">
<ul>
<li>
<p>Returns the ASCII message from the statusTable for the current status code.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remote_se_service">5. 'Remote SE' service</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-08-24 03:30:41 ╬le Maurice
</div>
</div>
</body>
</html>