<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2156px" preserveAspectRatio="none" style="width:1041px;height:2156px;" version="1.1" viewBox="0 0 1041 2156" width="1041px" zoomAndPan="magnify"><defs><filter height="300%" id="f1psfqkxhl01vm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1psfqkxhl01vm)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="260" x="13" y="286.7188"/><rect fill="#FFFFFF" filter="url(#f1psfqkxhl01vm)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="881.75"/><rect fill="#FFFFFF" filter="url(#f1psfqkxhl01vm)" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="233" x="786" y="1112.5625"/><rect fill="#FFFFFF" filter="url(#f1psfqkxhl01vm)" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="233" x="786" y="1453.1328"/><rect fill="#FFFFFF" filter="url(#f1psfqkxhl01vm)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="1744.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="41" x2="41" y1="87.6094" y2="2144.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="166" x2="166" y1="87.6094" y2="2144.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="269" x2="269" y1="87.6094" y2="2144.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="548" x2="548" y1="87.6094" y2="2144.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="846" x2="846" y1="87.6094" y2="2144.2188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="991" x2="991" y1="87.6094" y2="2144.2188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="23" y="84.5332">CPO</text><ellipse cx="41" cy="13" fill="#FEFECE" filter="url(#f1psfqkxhl01vm)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M41,21 L41,48 M28,29 L54,29 M41,48 L28,63 M41,48 L54,63 " fill="none" filter="url(#f1psfqkxhl01vm)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1psfqkxhl01vm)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="116" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="137.5" y="54.9238">PO local</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="123" y="72.5332">ProxyReader</text><rect fill="#FEFECE" filter="url(#f1psfqkxhl01vm)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="226" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="238.5" y="54.9238">Ticketing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="233" y="72.5332">application</text><rect fill="#FEFECE" filter="url(#f1psfqkxhl01vm)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="501" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="524.5" y="54.9238">Keyple</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="508" y="72.5332">Calypso API</text><rect fill="#FEFECE" filter="url(#f1psfqkxhl01vm)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="796" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="812.5" y="54.9238">CSM local</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="803" y="72.5332">ProxyReader</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="973" y="84.5332">CSM</text><ellipse cx="991" cy="13" fill="#FEFECE" filter="url(#f1psfqkxhl01vm)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M991,21 L991,48 M978,29 L1004,29 M991,48 L978,63 M991,48 L1004,63 " fill="none" filter="url(#f1psfqkxhl01vm)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#EEEEEE" filter="url(#f1psfqkxhl01vm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1026" x="3" y="118.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1029" y1="118.7852" y2="118.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1029" y1="121.7852" y2="121.7852"/><rect fill="#EEEEEE" filter="url(#f1psfqkxhl01vm)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="124" x="454" y="107.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="460" y="125.1045">PO Identification</text><polygon fill="#A80036" points="536,175.9609,546,179.9609,536,183.9609,540,179.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="542" y1="179.9609" y2="179.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="276" y="159.4561">transmit(SeRequest(AID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="276" y="175.8076">List&lt;PoRequestOutSession&gt;))</text><polygon fill="#0000FF" points="177,206.6641,167,210.6641,177,214.6641,173,210.6641" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="171" x2="547" y1="210.6641" y2="210.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="183" y="206.1592">PO 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="217" y="206.1592">SeRequest(AID, List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="52,237.0156,42,241.0156,52,245.0156,48,241.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="241.0156" y2="241.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="58" y="236.5107">SelectApplication</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="271.3672" y2="267.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="271.3672" y2="275.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="271.3672" y2="271.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="48" y="266.8623">PO serial</text><path d="M13,286.7188 L268,286.7188 L268,294.7188 L258,304.7188 L13,304.7188 L13,286.7188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="260" x="13" y="286.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="28" y="301.2139">'x' PO commands outside session</text><polygon fill="#A80036" points="52,323.0703,42,327.0703,52,331.0703,48,327.0703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="327.0703" y2="327.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="58" y="322.5654">ApduRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="357.4219" y2="353.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="357.4219" y2="361.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="357.4219" y2="357.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="48" y="352.917">ApduResponse</text><polygon fill="#0000FF" points="536,390.7734,546,394.7734,536,398.7734,540,394.7734" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="166" x2="542" y1="394.7734" y2="394.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="173" y="390.2686">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><polygon fill="#A80036" points="280,421.125,270,425.125,280,429.125,276,425.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="274" x2="547" y1="425.125" y2="425.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="286" y="420.6201">SeResponse(PO_FCI, List&lt;PoResponse&gt;))</text><rect fill="#EEEEEE" filter="url(#f1psfqkxhl01vm)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1026" x="3" y="454.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1029" y1="454.6523" y2="454.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1029" y1="457.6523" y2="457.6523"/><rect fill="#EEEEEE" filter="url(#f1psfqkxhl01vm)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="139" x="446.5" y="443.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="452.5" y="460.9717">PO Secure Session</text><polygon fill="#A80036" points="536,495.8281,546,499.8281,536,503.8281,540,499.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="542" y1="499.8281" y2="499.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="276" y="495.3232">processIdentification(PO_FCI)</text><polygon fill="#00FF00" points="834,542.1797,844,546.1797,834,550.1797,838,546.1797" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="840" y1="546.1797" y2="546.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="555" y="525.6748">CSM 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="599" y="525.6748">SeRequest(noAID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="555" y="542.0264">List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="979,572.8828,989,576.8828,979,580.8828,983,576.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="985" y1="576.8828" y2="576.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="853" y="572.3779">SelectDiversifier</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="607.2344" y2="603.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="607.2344" y2="611.2344"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="846" x2="990" y1="607.2344" y2="607.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="863" y="602.7295">ack</text><polygon fill="#A80036" points="979,633.5859,989,637.5859,979,641.5859,983,637.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="985" y1="637.5859" y2="637.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="853" y="633.0811">GetChallenge</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="667.9375" y2="663.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="667.9375" y2="671.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="846" x2="990" y1="667.9375" y2="667.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="863" y="663.4326">CSM challenge</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="558" y1="698.2891" y2="694.2891"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="558" y1="698.2891" y2="702.2891"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="548" x2="845" y1="698.2891" y2="698.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="565" y="693.7842">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="728.6406" y2="724.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="728.6406" y2="732.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="269" x2="547" y1="728.6406" y2="728.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="286" y="724.1357">SessionStatus_Identified</text><polygon fill="#A80036" points="536,770.9922,546,774.9922,536,778.9922,540,774.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="542" y1="774.9922" y2="774.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="276" y="754.4873">processOpening(OpenSessionRequest,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="276" y="770.8389">List&lt;PoRequestInSession&gt;)</text><polygon fill="#0000FF" points="177,801.6953,167,805.6953,177,809.6953,173,805.6953" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="171" x2="547" y1="805.6953" y2="805.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="183" y="801.1904">PO 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="217" y="801.1904">SeRequest(AID, List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="52,832.0469,42,836.0469,52,840.0469,48,836.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="836.0469" y2="836.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="58" y="831.542">OpenSession</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="866.3984" y2="862.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="866.3984" y2="870.3984"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="866.3984" y2="866.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="48" y="861.8936">PO challenge</text><path d="M13,881.75 L259,881.75 L259,889.75 L249,899.75 L13,899.75 L13,881.75 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="881.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="28" y="896.2451">'y' PO commands inside session</text><polygon fill="#A80036" points="52,918.1016,42,922.1016,52,926.1016,48,922.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="922.1016" y2="922.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="58" y="917.5967">ApduRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="952.4531" y2="948.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="952.4531" y2="956.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="952.4531" y2="952.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="48" y="947.9482">ApduResponse</text><polygon fill="#0000FF" points="536,985.8047,546,989.8047,536,993.8047,540,989.8047" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="166" x2="542" y1="989.8047" y2="989.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="173" y="985.2998">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><polygon fill="#00FF00" points="834,1032.1563,844,1036.1563,834,1040.1563,838,1036.1563" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="840" y1="1036.1563" y2="1036.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="555" y="1015.6514">CSM 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="599" y="1015.6514">SeRequest(noAID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="555" y="1032.0029">List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="979,1062.8594,989,1066.8594,979,1070.8594,983,1066.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="985" y1="1066.8594" y2="1066.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="853" y="1062.3545">DigestInit</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1097.2109" y2="1093.2109"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1097.2109" y2="1101.2109"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="846" x2="990" y1="1097.2109" y2="1097.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="863" y="1092.7061">ack</text><path d="M786,1112.5625 L1001,1112.5625 L1001,1120.5625 L991,1130.5625 L786,1130.5625 L786,1112.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="233" x="786" y="1112.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="801" y="1127.0576">'2 * y' session MAC updates</text><polygon fill="#A80036" points="979,1148.9141,989,1152.9141,979,1156.9141,983,1152.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="985" y1="1152.9141" y2="1152.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="853" y="1148.4092">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1183.2656" y2="1179.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1183.2656" y2="1187.2656"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="846" x2="990" y1="1183.2656" y2="1183.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="863" y="1178.7607">ack</text><polygon fill="#A80036" points="979,1209.6172,989,1213.6172,979,1217.6172,983,1213.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="985" y1="1213.6172" y2="1213.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="853" y="1209.1123">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1243.9688" y2="1239.9688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1243.9688" y2="1247.9688"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="846" x2="990" y1="1243.9688" y2="1243.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="863" y="1239.4639">ack</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="558" y1="1297.3203" y2="1293.3203"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="558" y1="1297.3203" y2="1301.3203"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="548" x2="845" y1="1297.3203" y2="1297.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="565" y="1276.8154">SeResponse(FCI,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="565" y="1293.167">List&lt;ApduResponse&gt;)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="1328.0234" y2="1324.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="1328.0234" y2="1332.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="269" x2="547" y1="1328.0234" y2="1328.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="286" y="1323.5186">SessionState_Open, List&lt;PoResponse&gt;</text><polygon fill="#A80036" points="536,1387.375,546,1391.375,536,1395.375,540,1391.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="542" y1="1391.375" y2="1391.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="276" y="1353.8701">processClosing(List&lt;PoRequestInSession&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="276" y="1370.2217">List&lt;AnticipatedPoResponse&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="276" y="1386.5732">PoRatificationCommand)</text><polygon fill="#00FF00" points="834,1433.4297,844,1437.4297,834,1441.4297,838,1437.4297" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="840" y1="1437.4297" y2="1437.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="555" y="1416.9248">CSM 3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="599" y="1416.9248">SeRequest(noAID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="555" y="1433.2764">List&lt;ApduRequest&gt;)</text><path d="M786,1453.1328 L1001,1453.1328 L1001,1461.1328 L991,1471.1328 L786,1471.1328 L786,1453.1328 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="233" x="786" y="1453.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="801" y="1467.6279">'2 * z' session MAC updates</text><polygon fill="#A80036" points="979,1489.4844,989,1493.4844,979,1497.4844,983,1493.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="985" y1="1493.4844" y2="1493.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="853" y="1488.9795">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1523.8359" y2="1519.8359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1523.8359" y2="1527.8359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="846" x2="990" y1="1523.8359" y2="1523.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="863" y="1519.3311">ack</text><polygon fill="#A80036" points="979,1550.1875,989,1554.1875,979,1558.1875,983,1554.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="985" y1="1554.1875" y2="1554.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="853" y="1549.6826">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1584.5391" y2="1580.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1584.5391" y2="1588.5391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="846" x2="990" y1="1584.5391" y2="1584.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="863" y="1580.0342">ack</text><polygon fill="#A80036" points="979,1617.8906,989,1621.8906,979,1625.8906,983,1621.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="985" y1="1621.8906" y2="1621.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="853" y="1617.3857">DigestClose</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1652.2422" y2="1648.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="1652.2422" y2="1656.2422"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="846" x2="990" y1="1652.2422" y2="1652.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="863" y="1647.7373">CSM certificate</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="558" y1="1682.5938" y2="1678.5938"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="558" y1="1682.5938" y2="1686.5938"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="548" x2="845" y1="1682.5938" y2="1682.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="565" y="1678.0889">CSM certificate</text><polygon fill="#0000FF" points="177,1724.9453,167,1728.9453,177,1732.9453,173,1728.9453" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="171" x2="547" y1="1728.9453" y2="1728.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="183" y="1708.4404">PO 3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="217" y="1708.4404">SeRequest(AID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="183" y="1724.792">List&lt;PoRequest&gt;)</text><path d="M13,1744.6484 L259,1744.6484 L259,1752.6484 L249,1762.6484 L13,1762.6484 L13,1744.6484 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="1744.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="28" y="1759.1436">'z' PO commands inside session</text><polygon fill="#A80036" points="52,1781,42,1785,52,1789,48,1785" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="1785" y2="1785"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="58" y="1780.4951">ApduRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1815.3516" y2="1811.3516"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1815.3516" y2="1819.3516"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="1815.3516" y2="1815.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="48" y="1810.8467">ApduResponse</text><polygon fill="#A80036" points="52,1848.7031,42,1852.7031,52,1856.7031,48,1852.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="1852.7031" y2="1852.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="58" y="1848.1982">CloseSession</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1883.0547" y2="1879.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1883.0547" y2="1887.0547"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="1883.0547" y2="1883.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="48" y="1878.5498">PO certificate</text><polygon fill="#A80036" points="52,1909.4063,42,1913.4063,52,1917.4063,48,1913.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="1913.4063" y2="1913.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="58" y="1908.9014">Ratification</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1943.7578" y2="1939.7578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1943.7578" y2="1947.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="1943.7578" y2="1943.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="48" y="1939.2529">ack</text><polygon fill="#0000FF" points="536,1970.1094,546,1974.1094,536,1978.1094,540,1974.1094" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="166" x2="542" y1="1974.1094" y2="1974.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="173" y="1969.6045">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><polygon fill="#00FF00" points="834,2000.4609,844,2004.4609,834,2008.4609,838,2004.4609" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="840" y1="2004.4609" y2="2004.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="555" y="1999.9561">CSM 4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="599" y="1999.9561">SeRequest(noAID, List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="979,2030.8125,989,2034.8125,979,2038.8125,983,2034.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="985" y1="2034.8125" y2="2034.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="853" y="2030.3076">ExternalAuthenticate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="2065.1641" y2="2061.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="856" y1="2065.1641" y2="2069.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="846" x2="990" y1="2065.1641" y2="2065.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="863" y="2060.6592">authentication status</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="558" y1="2095.5156" y2="2091.5156"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="548" x2="558" y1="2095.5156" y2="2099.5156"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="548" x2="845" y1="2095.5156" y2="2095.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="565" y="2091.0107">Authentification status</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="2125.8672" y2="2121.8672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="2125.8672" y2="2129.8672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="269" x2="547" y1="2125.8672" y2="2125.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="286" y="2121.3623">SessionState_Closed, List&lt;PoResponse&gt;</text><!--
@startuml
hide footbox

actor CPO as PO
participant "PO local\nProxyReader" as POR
participant "Ticketing\napplication" as TA
participant "Keyple\nCalypso API" as KC
participant "CSM local\nProxyReader" as SMR
actor CSM as SM

== PO Identification ==

TA->KC: transmit(SeRequest(AID,\nList<PoRequestOutSession>))
POR<[#0000FF]-KC: **PO 1** SeRequest(AID, List<ApduRequest>)
PO<-POR: SelectApplication
PO- ->>POR: PO serial
group 'x' PO commands outside session
PO<-POR: ApduRequest
PO- ->>POR: ApduResponse
end
POR- -[#0000FF]>KC: SeResponse(FCI, List<ApduResponse>)
TA<- -KC: SeResponse(PO_FCI, List<PoResponse>))

== PO Secure Session ==

TA->KC: processIdentification(PO_FCI)
KC-[#00FF00]>SMR: **CSM 1** SeRequest(noAID,\nList<ApduRequest>)
SMR->SM: SelectDiversifier
SMR<<- -SM: ack
SMR->SM: GetChallenge
SMR<<- -SM: CSM challenge
KC<<[#00FF00]- -SMR: SeResponse(FCI, List<ApduResponse>)
TA<<- -KC: SessionStatus_Identified

TA->KC: processOpening(OpenSessionRequest,\nList<PoRequestInSession>)
POR<[#0000FF]-KC: **PO 2** SeRequest(AID, List<ApduRequest>)
PO<-POR: OpenSession
PO- ->>POR: PO challenge
group 'y' PO commands inside session
PO<-POR: ApduRequest
PO- ->>POR: ApduResponse
end
POR- -[#0000FF]>KC: SeResponse(FCI, List<ApduResponse>)
KC-[#00FF00]>SMR: **CSM 2** SeRequest(noAID,\nList<ApduRequest>)
SMR->SM: DigestInit
SMR<<- -SM:ack
group '2 * y' session MAC updates
SMR->SM: DigestUpdate
SMR<<- -SM: ack
SMR->SM: DigestUpdate
SMR<<- -SM: ack
end
KC<<[#00FF00]- -SMR: SeResponse(FCI,\nList<ApduResponse>)
TA<<- -KC: SessionState_Open, List<PoResponse>

TA->KC: processClosing(List<PoRequestInSession>,\nList<AnticipatedPoResponse>,\nPoRatificationCommand)
KC-[#00FF00]>SMR: **CSM 3** SeRequest(noAID,\nList<ApduRequest>)
group '2 * z' session MAC updates
SMR->SM: DigestUpdate
SMR<<- -SM: ack
SMR->SM: DigestUpdate
SMR<<- -SM: ack
end
SMR->SM: DigestClose
SMR<<- -SM: CSM certificate
KC<<[#00FF00]- -SMR: CSM certificate
POR<[#0000FF]-KC: **PO 3** SeRequest(AID,\nList<PoRequest>)
group 'z' PO commands inside session
PO<-POR: ApduRequest
PO- ->>POR: ApduResponse
end
PO<-POR: CloseSession
PO- ->>POR: PO certificate
PO<-POR: Ratification
PO- ->>POR: ack
POR- -[#0000FF]>KC: SeResponse(FCI, List<ApduResponse>)
KC-[#00FF00]>SMR: **CSM 4** SeRequest(noAID, List<ApduRequest>)
SMR->SM: ExternalAuthenticate
SMR<<- -SM: authentication status
KC<<[#00FF00]- -SMR: Authentification status
TA<<- -KC: SessionState_Closed, List<PoResponse>
@enduml

PlantUML version 1.2018.01(Sun Jan 28 19:08:22 CET 2018)
(APACHE source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 10.0.1+10
Operating System: Windows 10
OS Version: 10.0
Default Encoding: Cp1252
Language: fr
Country: FR
--></g></svg>