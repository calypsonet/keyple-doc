<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2032px" preserveAspectRatio="none" style="width:1080px;height:2032px;" version="1.1" viewBox="0 0 1080 2032" width="1080px" zoomAndPan="magnify"><defs><filter height="300%" id="f8cv7rop1enyf" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f8cv7rop1enyf)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="260" x="13" y="286.7188"/><rect fill="#FFFFFF" filter="url(#f8cv7rop1enyf)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="851.3984"/><rect fill="#FFFFFF" filter="url(#f8cv7rop1enyf)" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="233" x="825" y="1175.6172"/><rect fill="#FFFFFF" filter="url(#f8cv7rop1enyf)" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="233" x="825" y="1329.375"/><rect fill="#FFFFFF" filter="url(#f8cv7rop1enyf)" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="1620.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="41" x2="41" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="166" x2="166" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="269" x2="269" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="583" x2="583" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="885" x2="885" y1="87.6094" y2="2020.4609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1030" x2="1030" y1="87.6094" y2="2020.4609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="23" y="84.5332">CPO</text><ellipse cx="41" cy="13" fill="#FEFECE" filter="url(#f8cv7rop1enyf)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M41,21 L41,48 M28,29 L54,29 M41,48 L28,63 M41,48 L54,63 " fill="none" filter="url(#f8cv7rop1enyf)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f8cv7rop1enyf)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="116" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="137.5" y="54.9238">PO local</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="123" y="72.5332">ProxyReader</text><rect fill="#FEFECE" filter="url(#f8cv7rop1enyf)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="82" x="226" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="238.5" y="54.9238">Ticketing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="233" y="72.5332">application</text><rect fill="#FEFECE" filter="url(#f8cv7rop1enyf)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="536" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="559.5" y="54.9238">Keyple</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="543" y="72.5332">Calypso API</text><rect fill="#FEFECE" filter="url(#f8cv7rop1enyf)" height="49.2188" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="835" y="33.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="851.5" y="54.9238">CSM local</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="842" y="72.5332">ProxyReader</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="1012" y="84.5332">CSM</text><ellipse cx="1030" cy="13" fill="#FEFECE" filter="url(#f8cv7rop1enyf)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1030,21 L1030,48 M1017,29 L1043,29 M1030,48 L1017,63 M1030,48 L1043,63 " fill="none" filter="url(#f8cv7rop1enyf)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#EEEEEE" filter="url(#f8cv7rop1enyf)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1065" x="3" y="118.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1068" y1="118.7852" y2="118.7852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1068" y1="121.7852" y2="121.7852"/><rect fill="#EEEEEE" filter="url(#f8cv7rop1enyf)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="124" x="473.5" y="107.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="479.5" y="125.1045">PO Identification</text><polygon fill="#A80036" points="571,175.9609,581,179.9609,571,183.9609,575,179.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="577" y1="179.9609" y2="179.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="276" y="159.4561">transmit(SeRequest(AID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="276" y="175.8076">List&lt;PoRequestOutSession&gt;))</text><polygon fill="#0000FF" points="177,206.6641,167,210.6641,177,214.6641,173,210.6641" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="171" x2="582" y1="210.6641" y2="210.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="183" y="206.1592">PO 1: SeRequest(AID, List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="52,237.0156,42,241.0156,52,245.0156,48,241.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="241.0156" y2="241.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="58" y="236.5107">SelectApplication</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="271.3672" y2="267.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="271.3672" y2="275.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="271.3672" y2="271.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="48" y="266.8623">PO serial</text><path d="M13,286.7188 L268,286.7188 L268,294.7188 L258,304.7188 L13,304.7188 L13,286.7188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="260" x="13" y="286.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="28" y="301.2139">'x' PO commands outside session</text><polygon fill="#A80036" points="52,323.0703,42,327.0703,52,331.0703,48,327.0703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="327.0703" y2="327.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="58" y="322.5654">ApduRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="357.4219" y2="353.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="357.4219" y2="361.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="357.4219" y2="357.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="48" y="352.917">ApduResponse</text><polygon fill="#0000FF" points="571,390.7734,581,394.7734,571,398.7734,575,394.7734" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="166" x2="577" y1="394.7734" y2="394.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="173" y="390.2686">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><polygon fill="#A80036" points="280,421.125,270,425.125,280,429.125,276,425.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="274" x2="582" y1="425.125" y2="425.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="286" y="420.6201">SeResponse(PO_FCI, List&lt;PoResponse&gt;))</text><rect fill="#EEEEEE" filter="url(#f8cv7rop1enyf)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1065" x="3" y="454.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1068" y1="454.6523" y2="454.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1068" y1="457.6523" y2="457.6523"/><rect fill="#EEEEEE" filter="url(#f8cv7rop1enyf)" height="24.3516" style="stroke: #000000; stroke-width: 2.0;" width="139" x="466" y="443.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="472" y="460.9717">PO Secure Session</text><polygon fill="#A80036" points="571,511.8281,581,515.8281,571,519.8281,575,515.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="577" y1="515.8281" y2="515.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="276" y="495.3232">processOpening</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="378" y="495.3232">(PO_FCI, OpenSessionRequest,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="276" y="511.6748">List&lt;PoRequestInSession&gt;)</text><polygon fill="#00FF00" points="873,558.5313,883,562.5313,873,566.5313,877,562.5313" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="583" x2="879" y1="562.5313" y2="562.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="590" y="542.0264">CSM 1: SeRequest(noAID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="590" y="558.3779">List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="1018,589.2344,1028,593.2344,1018,597.2344,1022,593.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="1024" y1="593.2344" y2="593.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="892" y="588.7295">SelectDiversifier</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="623.5859" y2="619.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="623.5859" y2="627.5859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="885" x2="1029" y1="623.5859" y2="623.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="902" y="619.0811">ack</text><polygon fill="#A80036" points="1018,649.9375,1028,653.9375,1018,657.9375,1022,653.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="1024" y1="653.9375" y2="653.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="892" y="649.4326">GetChallenge</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="684.2891" y2="680.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="684.2891" y2="688.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="885" x2="1029" y1="684.2891" y2="684.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="902" y="679.7842">CSM challenge</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="583" x2="593" y1="714.6406" y2="710.6406"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="583" x2="593" y1="714.6406" y2="718.6406"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="583" x2="884" y1="714.6406" y2="714.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="600" y="710.1357">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="744.9922" y2="740.9922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="744.9922" y2="748.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="269" x2="582" y1="744.9922" y2="744.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="286" y="740.4873">SessionStatus_Identified</text><polygon fill="#0000FF" points="177,771.3438,167,775.3438,177,779.3438,173,775.3438" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="171" x2="582" y1="775.3438" y2="775.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="183" y="770.8389">PO 2: SeRequest(AID, List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="52,801.6953,42,805.6953,52,809.6953,48,805.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="805.6953" y2="805.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="58" y="801.1904">OpenSession</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="836.0469" y2="832.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="836.0469" y2="840.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="836.0469" y2="836.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="48" y="831.542">PO challenge</text><path d="M13,851.3984 L259,851.3984 L259,859.3984 L249,869.3984 L13,869.3984 L13,851.3984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="851.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="28" y="865.8936">'y' PO commands inside session</text><polygon fill="#A80036" points="52,887.75,42,891.75,52,895.75,48,891.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="891.75" y2="891.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="58" y="887.2451">ApduRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="922.1016" y2="918.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="922.1016" y2="926.1016"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="922.1016" y2="922.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="48" y="917.5967">ApduResponse</text><polygon fill="#0000FF" points="571,955.4531,581,959.4531,571,963.4531,575,959.4531" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="166" x2="577" y1="959.4531" y2="959.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="173" y="954.9482">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="989.8047" y2="985.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="989.8047" y2="993.8047"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="269" x2="582" y1="989.8047" y2="989.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="286" y="985.2998">SessionState_Open, List&lt;PoResponse&gt;</text><polygon fill="#A80036" points="571,1049.1563,581,1053.1563,571,1057.1563,575,1053.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="577" y1="1053.1563" y2="1053.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="95" x="276" y="1015.6514">processClosing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="371" y="1015.6514">(List&lt;PoRequestInSession&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="276" y="1032.0029">List&lt;AnticipatedPoResponse&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="276" y="1048.3545">PoRatificationCommand)</text><polygon fill="#00FF00" points="873,1095.2109,883,1099.2109,873,1103.2109,877,1099.2109" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="583" x2="879" y1="1099.2109" y2="1099.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="590" y="1078.7061">CSM 2: SeRequest(noAID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="590" y="1095.0576">List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="1018,1125.9141,1028,1129.9141,1018,1133.9141,1022,1129.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="1024" y1="1129.9141" y2="1129.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="892" y="1125.4092">DigestInit</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1160.2656" y2="1156.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1160.2656" y2="1164.2656"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="885" x2="1029" y1="1160.2656" y2="1160.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="902" y="1155.7607">ack</text><path d="M825,1175.6172 L1040,1175.6172 L1040,1183.6172 L1030,1193.6172 L825,1193.6172 L825,1175.6172 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="233" x="825" y="1175.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="840" y="1190.1123">'2 * y' session MAC updates</text><polygon fill="#A80036" points="1018,1211.9688,1028,1215.9688,1018,1219.9688,1022,1215.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="1024" y1="1215.9688" y2="1215.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="892" y="1211.4639">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1246.3203" y2="1242.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1246.3203" y2="1250.3203"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="885" x2="1029" y1="1246.3203" y2="1246.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="902" y="1241.8154">ack</text><polygon fill="#A80036" points="1018,1272.6719,1028,1276.6719,1018,1280.6719,1022,1276.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="1024" y1="1276.6719" y2="1276.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="892" y="1272.167">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1307.0234" y2="1303.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1307.0234" y2="1311.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="885" x2="1029" y1="1307.0234" y2="1307.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="902" y="1302.5186">ack</text><path d="M825,1329.375 L1040,1329.375 L1040,1337.375 L1030,1347.375 L825,1347.375 L825,1329.375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="139.7578" style="stroke: #000000; stroke-width: 2.0;" width="233" x="825" y="1329.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="840" y="1343.8701">'2 * z' session MAC updates</text><polygon fill="#A80036" points="1018,1365.7266,1028,1369.7266,1018,1373.7266,1022,1369.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="1024" y1="1369.7266" y2="1369.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="892" y="1365.2217">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1400.0781" y2="1396.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1400.0781" y2="1404.0781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="885" x2="1029" y1="1400.0781" y2="1400.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="902" y="1395.5732">ack</text><polygon fill="#A80036" points="1018,1426.4297,1028,1430.4297,1018,1434.4297,1022,1430.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="1024" y1="1430.4297" y2="1430.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="892" y="1425.9248">DigestUpdate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1460.7813" y2="1456.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1460.7813" y2="1464.7813"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="885" x2="1029" y1="1460.7813" y2="1460.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="902" y="1456.2764">ack</text><polygon fill="#A80036" points="1018,1494.1328,1028,1498.1328,1018,1502.1328,1022,1498.1328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="1024" y1="1498.1328" y2="1498.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="892" y="1493.6279">DigestClose</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1528.4844" y2="1524.4844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1528.4844" y2="1532.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="885" x2="1029" y1="1528.4844" y2="1528.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="902" y="1523.9795">CSM certificate</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="583" x2="593" y1="1558.8359" y2="1554.8359"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="583" x2="593" y1="1558.8359" y2="1562.8359"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="583" x2="884" y1="1558.8359" y2="1558.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="600" y="1554.3311">CSM certificate</text><polygon fill="#0000FF" points="177,1601.1875,167,1605.1875,177,1609.1875,173,1605.1875" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="171" x2="582" y1="1605.1875" y2="1605.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="183" y="1584.6826">PO 3: SeRequest(AID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="183" y="1601.0342">List&lt;PoRequest&gt;)</text><path d="M13,1620.8906 L259,1620.8906 L259,1628.8906 L249,1638.8906 L13,1638.8906 L13,1620.8906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="79.0547" style="stroke: #000000; stroke-width: 2.0;" width="251" x="13" y="1620.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="28" y="1635.3857">'z' PO commands inside session</text><polygon fill="#A80036" points="52,1657.2422,42,1661.2422,52,1665.2422,48,1661.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="1661.2422" y2="1661.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="58" y="1656.7373">ApduRequest</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1691.5938" y2="1687.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1691.5938" y2="1695.5938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="1691.5938" y2="1691.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="48" y="1687.0889">ApduResponse</text><polygon fill="#A80036" points="52,1724.9453,42,1728.9453,52,1732.9453,48,1728.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="1728.9453" y2="1728.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="58" y="1724.4404">CloseSession</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1759.2969" y2="1755.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1759.2969" y2="1763.2969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="1759.2969" y2="1759.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="48" y="1754.792">PO certificate</text><polygon fill="#A80036" points="52,1785.6484,42,1789.6484,52,1793.6484,48,1789.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="165" y1="1789.6484" y2="1789.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="58" y="1785.1436">Ratification</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1820" y2="1816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164" x2="154" y1="1820" y2="1824"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="165" y1="1820" y2="1820"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="48" y="1815.4951">ack</text><polygon fill="#0000FF" points="571,1846.3516,581,1850.3516,571,1854.3516,575,1850.3516" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="166" x2="577" y1="1850.3516" y2="1850.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="173" y="1845.8467">SeResponse(FCI, List&lt;ApduResponse&gt;)</text><polygon fill="#00FF00" points="873,1876.7031,883,1880.7031,873,1884.7031,877,1880.7031" style="stroke: #00FF00; stroke-width: 1.0;"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="583" x2="879" y1="1880.7031" y2="1880.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="590" y="1876.1982">CSM 3: SeRequest(noAID, List&lt;ApduRequest&gt;)</text><polygon fill="#A80036" points="1018,1907.0547,1028,1911.0547,1018,1915.0547,1022,1911.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="1024" y1="1911.0547" y2="1911.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="892" y="1906.5498">ExternalAuthenticate</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1941.4063" y2="1937.4063"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="885" x2="895" y1="1941.4063" y2="1945.4063"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="885" x2="1029" y1="1941.4063" y2="1941.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="902" y="1936.9014">authentication status</text><line style="stroke: #00FF00; stroke-width: 1.0;" x1="583" x2="593" y1="1971.7578" y2="1967.7578"/><line style="stroke: #00FF00; stroke-width: 1.0;" x1="583" x2="593" y1="1971.7578" y2="1975.7578"/><line style="stroke: #00FF00; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="583" x2="884" y1="1971.7578" y2="1971.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="600" y="1967.2529">Authentification status</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="2002.1094" y2="1998.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="269" x2="279" y1="2002.1094" y2="2006.1094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="269" x2="582" y1="2002.1094" y2="2002.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="286" y="1997.6045">SessionState_Closed, List&lt;PoResponse&gt;</text><!--
@startuml
hide footbox

actor CPO as PO
participant "PO local\nProxyReader" as POR
participant "Ticketing\napplication" as TA
participant "Keyple\nCalypso API" as KC
participant "CSM local\nProxyReader" as SMR
actor CSM as SM

== PO Identification ==

TA->KC: transmit(SeRequest(AID,\nList<PoRequestOutSession>))
POR<[#0000FF]-KC: PO 1: SeRequest(AID, List<ApduRequest>)
PO<-POR: SelectApplication
PO- ->>POR: PO serial
group 'x' PO commands outside session
PO<-POR: ApduRequest
PO- ->>POR: ApduResponse
end
POR- -[#0000FF]>KC: SeResponse(FCI, List<ApduResponse>)
TA<- -KC: SeResponse(PO_FCI, List<PoResponse>))

== PO Secure Session ==

TA->KC: **processOpening**(PO_FCI, OpenSessionRequest,\nList<PoRequestInSession>)
KC-[#00FF00]>SMR: CSM 1: SeRequest(noAID,\nList<ApduRequest>)
SMR->SM: SelectDiversifier
SMR<<- -SM: ack
SMR->SM: GetChallenge
SMR<<- -SM: CSM challenge
KC<<[#00FF00]- -SMR: SeResponse(FCI, List<ApduResponse>)
TA<<- -KC: SessionStatus_Identified
POR<[#0000FF]-KC: PO 2: SeRequest(AID, List<ApduRequest>)
PO<-POR: OpenSession
PO- ->>POR: PO challenge
group 'y' PO commands inside session
PO<-POR: ApduRequest
PO- ->>POR: ApduResponse
end
POR- -[#0000FF]>KC: SeResponse(FCI, List<ApduResponse>)

TA<<- -KC: SessionState_Open, List<PoResponse>

TA->KC: **processClosing**(List<PoRequestInSession>,\nList<AnticipatedPoResponse>,\nPoRatificationCommand)

KC-[#00FF00]>SMR: CSM 2: SeRequest(noAID,\nList<ApduRequest>)
SMR->SM: DigestInit
SMR<<- -SM:ack
group '2 * y' session MAC updates
SMR->SM: DigestUpdate
SMR<<- -SM: ack
SMR->SM: DigestUpdate
SMR<<- -SM: ack
end
group '2 * z' session MAC updates
SMR->SM: DigestUpdate
SMR<<- -SM: ack
SMR->SM: DigestUpdate
SMR<<- -SM: ack
end
SMR->SM: DigestClose
SMR<<- -SM: CSM certificate
KC<<[#00FF00]- -SMR: CSM certificate
POR<[#0000FF]-KC: PO 3: SeRequest(AID,\nList<PoRequest>)
group 'z' PO commands inside session
PO<-POR: ApduRequest
PO- ->>POR: ApduResponse
end
PO<-POR: CloseSession
PO- ->>POR: PO certificate
PO<-POR: Ratification
PO- ->>POR: ack
POR- -[#0000FF]>KC: SeResponse(FCI, List<ApduResponse>)
KC-[#00FF00]>SMR: CSM 3: SeRequest(noAID, List<ApduRequest>)
SMR->SM: ExternalAuthenticate
SMR<<- -SM: authentication status
KC<<[#00FF00]- -SMR: Authentification status
TA<<- -KC: SessionState_Closed, List<PoResponse>
@enduml

PlantUML version 1.2018.01(Sun Jan 28 22:08:22 MUT 2018)
(APACHE source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 10.0.1+10
Operating System: Windows 10
OS Version: 10.0
Default Encoding: Cp1252
Language: fr
Country: FR
--></g></svg>