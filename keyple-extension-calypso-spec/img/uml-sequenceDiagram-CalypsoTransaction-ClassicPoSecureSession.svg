<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1332px" preserveAspectRatio="none" style="width:759px;height:1332px;" version="1.1" viewBox="0 0 759 1332" width="759px" zoomAndPan="magnify"><defs><filter height="300%" id="fcezlqxebm17n" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fcezlqxebm17n)" height="167.7578" style="stroke: #000000; stroke-width: 2.0;" width="502" x="13" y="165.3125"/><rect fill="#FFFFFF" filter="url(#fcezlqxebm17n)" height="167.7578" style="stroke: #000000; stroke-width: 2.0;" width="502" x="13" y="589.8828"/><rect fill="#FFFFFF" filter="url(#fcezlqxebm17n)" height="289.1641" style="stroke: #000000; stroke-width: 2.0;" width="395" x="353" y="771.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="41" x2="41" y1="87.6094" y2="244.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="41" x2="41" y1="244.3672" y2="272.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="41" x2="41" y1="272.3672" y2="668.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="41" x2="41" y1="668.9375" y2="696.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="41" x2="41" y1="696.9375" y2="911.3984"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="41" x2="41" y1="911.3984" y2="939.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="41" x2="41" y1="939.3984" y2="1320.6172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="434" y1="87.6094" y2="244.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="434" x2="434" y1="244.3672" y2="272.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="434" y1="272.3672" y2="668.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="434" x2="434" y1="668.9375" y2="696.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="434" y1="696.9375" y2="911.3984"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="434" x2="434" y1="911.3984" y2="939.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="434" y1="939.3984" y2="1320.6172"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="720" x2="720" y1="87.6094" y2="244.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="720" x2="720" y1="244.3672" y2="272.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="720" x2="720" y1="272.3672" y2="668.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="720" x2="720" y1="668.9375" y2="696.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="720" x2="720" y1="696.9375" y2="911.3984"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="720" x2="720" y1="911.3984" y2="939.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="720" x2="720" y1="939.3984" y2="1320.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="23" y="84.5332">CPO</text><ellipse cx="41" cy="13" fill="#FEFECE" filter="url(#fcezlqxebm17n)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M41,21 L41,48 M28,29 L54,29 M41,48 L28,63 M41,48 L54,63 " fill="none" filter="url(#fcezlqxebm17n)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fcezlqxebm17n)" height="66.8281" style="stroke: #A80036; stroke-width: 1.5;" width="138" x="363" y="15.7813"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="370" y="37.3145">Calypso processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="376.5" y="54.9238">terminal with local</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="372" y="72.5332">PO &amp; CSM readers</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="702" y="84.5332">CSM</text><ellipse cx="720" cy="13" fill="#FEFECE" filter="url(#fcezlqxebm17n)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M720,21 L720,48 M707,29 L733,29 M720,48 L707,63 M720,48 L733,63 " fill="none" filter="url(#fcezlqxebm17n)" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="52,115.6094,42,119.6094,52,123.6094,48,119.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="433" y1="119.6094" y2="119.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="58" y="115.1045">[1]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="77" y="115.1045">SelectApplication(AID)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="149.9609" y2="145.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="149.9609" y2="153.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="433" y1="149.9609" y2="149.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="48" y="145.4561">PO serial</text><path d="M13,165.3125 L168,165.3125 L168,173.3125 L158,183.3125 L13,183.3125 L13,165.3125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="167.7578" style="stroke: #000000; stroke-width: 2.0;" width="502" x="13" y="165.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="28" y="179.8076">'x' PO commands</text><polygon fill="#A80036" points="52,201.6641,42,205.6641,52,209.6641,48,205.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="433" y1="205.6641" y2="205.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="58" y="201.1592">[2]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="77" y="201.1592">Free Read/Write commands outside session</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="236.0156" y2="232.0156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="236.0156" y2="240.0156"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="433" y1="236.0156" y2="236.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="48" y="231.5107">commands' responses</text><polygon fill="#A80036" points="52,290.3672,42,294.3672,52,298.3672,48,294.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="433" y1="294.3672" y2="294.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="58" y="289.8623">[1 + x]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="101" y="289.8623">Free Read/Write commands outside session</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="324.7188" y2="320.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="324.7188" y2="328.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="433" y1="324.7188" y2="324.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="48" y="320.2139">commands' responses</text><polygon fill="#A80036" points="708,358.0703,718,362.0703,708,366.0703,712,362.0703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="714" y1="362.0703" y2="362.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="441" y="357.5654">[1]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="460" y="357.5654">SelectDiversifier(PO serial)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="392.4219" y2="388.4219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="392.4219" y2="396.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="434" x2="719" y1="392.4219" y2="392.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="451" y="387.917">ack</text><polygon fill="#A80036" points="708,418.7734,718,422.7734,708,426.7734,712,422.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="714" y1="422.7734" y2="422.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="441" y="418.2686">[2]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="460" y="418.2686">GetChallenge</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="453.125" y2="449.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="453.125" y2="457.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="434" x2="719" y1="453.125" y2="453.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="451" y="448.6201">CSM challenge</text><polygon fill="#A80036" points="52,479.4766,42,483.4766,52,487.4766,48,483.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="433" y1="483.4766" y2="483.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="58" y="478.9717">[2 + x]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="101" y="478.9717">OpenSession(key index, CSM challenge, record to read)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="513.8281" y2="509.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="513.8281" y2="517.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="433" y1="513.8281" y2="513.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="48" y="509.3232">PO challenge, key reference, read data</text><polygon fill="#A80036" points="708,540.1797,718,544.1797,708,548.1797,712,544.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="714" y1="544.1797" y2="544.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="441" y="539.6748">[3]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="460" y="539.6748">DigestInit(OpenSession data)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="574.5313" y2="570.5313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="574.5313" y2="578.5313"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="434" x2="719" y1="574.5313" y2="574.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="451" y="570.0264">ack</text><path d="M13,589.8828 L167,589.8828 L167,597.8828 L157,607.8828 L13,607.8828 L13,589.8828 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="167.7578" style="stroke: #000000; stroke-width: 2.0;" width="502" x="13" y="589.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="28" y="604.3779">'y' PO commands</text><polygon fill="#A80036" points="52,626.2344,42,630.2344,52,634.2344,48,630.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="433" y1="630.2344" y2="630.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="58" y="625.7295">[3 + x]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="101" y="625.7295">Read/Write commands inside session</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="660.5859" y2="656.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="660.5859" y2="664.5859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="433" y1="660.5859" y2="660.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="48" y="656.0811">commands' responses</text><polygon fill="#A80036" points="52,714.9375,42,718.9375,52,722.9375,48,718.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="433" y1="718.9375" y2="718.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="58" y="714.4326">[2 + x + y]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="124" y="714.4326">Read/Write commands inside session</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="749.2891" y2="745.2891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="749.2891" y2="753.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="433" y1="749.2891" y2="749.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="48" y="744.7842">commands' responses</text><path d="M353,771.6406 L695,771.6406 L695,779.6406 L685,789.6406 L353,789.6406 L353,771.6406 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="289.1641" style="stroke: #000000; stroke-width: 2.0;" width="395" x="353" y="771.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="297" x="368" y="786.1357">'2 * y' session MAC updates with PO commands</text><polygon fill="#A80036" points="708,807.9922,718,811.9922,708,815.9922,712,811.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="714" y1="811.9922" y2="811.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="441" y="807.4873">[4]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="460" y="807.4873">DigestUpdate(PO command)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="842.3438" y2="838.3438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="842.3438" y2="846.3438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="434" x2="719" y1="842.3438" y2="842.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="451" y="837.8389">ack</text><polygon fill="#A80036" points="708,868.6953,718,872.6953,708,876.6953,712,872.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="714" y1="872.6953" y2="872.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="441" y="868.1904">[5]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="460" y="868.1904">DigestUpdate(PO response)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="903.0469" y2="899.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="903.0469" y2="907.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="434" x2="719" y1="903.0469" y2="903.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="451" y="898.542">ack</text><polygon fill="#A80036" points="708,957.3984,718,961.3984,708,965.3984,712,961.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="714" y1="961.3984" y2="961.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="441" y="956.8936">[3 + (2*y-1)]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="514" y="956.8936">DigestUpdate(PO command)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="991.75" y2="987.75"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="991.75" y2="995.75"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="434" x2="719" y1="991.75" y2="991.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="451" y="987.2451">ack</text><polygon fill="#A80036" points="708,1018.1016,718,1022.1016,708,1026.1016,712,1022.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="714" y1="1022.1016" y2="1022.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="50" x="441" y="1017.5967">[3 + 2*y]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="495" y="1017.5967">DigestUpdate(PO response)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="1052.4531" y2="1048.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="1052.4531" y2="1056.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="434" x2="719" y1="1052.4531" y2="1052.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="451" y="1047.9482">ack</text><polygon fill="#A80036" points="708,1085.8047,718,1089.8047,708,1093.8047,712,1089.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="714" y1="1089.8047" y2="1089.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="50" x="441" y="1085.2998">[4 + 2*y]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="495" y="1085.2998">DigestClose</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="1120.1563" y2="1116.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="1120.1563" y2="1124.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="434" x2="719" y1="1120.1563" y2="1120.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="451" y="1115.6514">CSM certificate</text><polygon fill="#A80036" points="52,1146.5078,42,1150.5078,52,1154.5078,48,1150.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="433" y1="1150.5078" y2="1150.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="58" y="1146.0029">[3 + x + y]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="124" y="1146.0029">CloseSession(CSM certificate)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="1180.8594" y2="1176.8594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="1180.8594" y2="1184.8594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="433" y1="1180.8594" y2="1180.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="48" y="1176.3545">PO certificate</text><polygon fill="#A80036" points="52,1207.2109,42,1211.2109,52,1215.2109,48,1211.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46" x2="433" y1="1211.2109" y2="1211.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="58" y="1206.7061">[4 + x + y]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="124" y="1206.7061">Ratification command</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="1241.5625" y2="1237.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="422" y1="1241.5625" y2="1245.5625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="433" y1="1241.5625" y2="1241.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="48" y="1237.0576">ack</text><polygon fill="#A80036" points="708,1267.9141,718,1271.9141,708,1275.9141,712,1271.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="714" y1="1271.9141" y2="1271.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="50" x="441" y="1267.4092">[5 + 2*y]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="495" y="1267.4092">ExternalAuthenticate(PO certificate)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="1302.2656" y2="1298.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="434" x2="444" y1="1302.2656" y2="1306.2656"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="434" x2="719" y1="1302.2656" y2="1302.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="451" y="1297.7607">authentication status</text><!--
@startuml
hide footbox

actor CPO as P
participant "Calypso processing\nterminal with local\nPO & CSM readers" as T
actor CSM as S

P<-T: **[1]** SelectApplication(AID)
P- ->>T: PO serial
group 'x' PO commands
P<-T: **[2]** Free Read/Write commands outside session
P- ->>T: commands' responses
...
P<-T: **[1 + x]** Free Read/Write commands outside session
P- ->>T: commands' responses
end
T->S: **[1]** SelectDiversifier(PO serial)
T<<- -S: ack
T->S: **[2]** GetChallenge
T<<- -S: CSM challenge
P<-T: **[2 + x]** OpenSession(key index, CSM challenge, record to read)
P- ->>T: PO challenge, key reference, read data
T->S: **[3]** DigestInit(OpenSession data)
T<<- -S:ack
group 'y' PO commands
P<-T: **[3 + x]** Read/Write commands inside session
P- ->>T: commands' responses
...
P<-T: **[2 + x + y]** Read/Write commands inside session
P- ->>T: commands' responses
end
group '2 * y' session MAC updates with PO commands
T->S: **[4]** DigestUpdate(PO command)
T<<- -S: ack
T->S: **[5]** DigestUpdate(PO response)
T<<- -S: ack
...
T->S: **[3 + (2*y-1)]** DigestUpdate(PO command)
T<<- -S: ack
T->S: **[3 + 2*y]** DigestUpdate(PO response)
T<<- -S: ack
end
T->S: **[4 + 2*y]** DigestClose
T<<- -S: CSM certificate
P<-T: **[3 + x + y]** CloseSession(CSM certificate)
P- ->>T: PO certificate
P<-T: **[4 + x + y]** Ratification command
P- ->>T: ack
T->S: **[5 + 2*y]** ExternalAuthenticate(PO certificate)
T<<- -S: authentication status
@enduml

PlantUML version 1.2018.01(Sun Jan 28 22:08:22 MUT 2018)
(APACHE source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 10.0.1+10
Operating System: Windows 10
OS Version: 10.0
Default Encoding: Cp1252
Language: fr
Country: FR
--></g></svg>